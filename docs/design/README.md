# a11y-shogi デザインドキュメント

このディレクトリには、アクセシビリティに配慮した将棋アプリケーション「a11y-shogi」の完全な設計ドキュメントが含まれています。

## 📚 ドキュメント一覧

### 1. [00_PROJECT_OVERVIEW.md](./00_PROJECT_OVERVIEW.md)
プロジェクト全体の概要と基本方針

**含まれる内容**
- プロジェクト名とビジョン
- コア機能（ゲーム機能、アクセシビリティ機能、UX機能）
- 技術スタック
- ユーザー層と成功指標

**対象読者**: プロジェクト管理者、全チームメンバー

---

### 2. [01_SYSTEM_ARCHITECTURE.md](./01_SYSTEM_ARCHITECTURE.md)
システム全体のアーキテクチャと技術設計

**含まれる内容**
- 全体構成図（フロントエンド、バックエンド、DB）
- 5層アーキテクチャ（プレゼンテーション、アプリケーション、ビジネスロジック、データアクセス、DB）
- セッション管理フロー
- ゲーム状態管理スキーマ
- API応答フォーマット
- スケーラビリティ考慮

**対象読者**: アーキテクト、バックエンド開発者、サーバーサイド開発者

---

### 3. [02_USER_FLOWS.md](./02_USER_FLOWS.md)
ユーザーの操作フローと具体的なシナリオ

**含まれる内容**
- 初回訪問フロー
- 新規対局開始フロー
- 対局中のターンごとのフロー
- ゲーム終了フロー
- キーボード操作フロー
- セッション復帰フロー
- 具体的なユーザーシナリオ（スクリーンリーダー利用者、キーボード利用者）

**対象読者**: UI/UX デザイナー、フロントエンド開発者、QA テスター

---

### 4. [03_DATABASE_DESIGN.md](./03_DATABASE_DESIGN.md)
データベーススキーマと実装詳細

**含まれる内容**
- テーブル定義（game_sessions, game_moves, board_states）
- JSONスキーマ例
- マイグレーションコード
- DBアクセスパターン
- インデックス戦略
- 将来的な最適化案
- データ保持ポリシー

**対象読者**: データベース設計者、バックエンド開発者

---

### 5. [04_API_SPECIFICATION.md](./04_API_SPECIFICATION.md)
RESTful API の完全仕様書

**含まれる内容**
- 基本情報（ベースURL、フォーマット、認証）
- エンドポイント一覧
- 8つの詳細仕様
  - GET / (ホーム画面)
  - POST /game/start (新規ゲーム開始)
  - GET /game/{sessionId} (ゲーム画面表示)
  - POST /game/{sessionId}/move (指し手送信)
  - POST /game/{sessionId}/undo (棋譜を戻す)
  - POST /game/{sessionId}/resign (投了)
  - GET /game/{sessionId}/state (ゲーム状態取得)
  - GET /help (ヘルプページ)
- エラーコード一覧
- HTTPステータスコード
- セキュリティ対策

**対象読者**: フロントエンド開発者、API クライアント実装者、テスター

---

### 6. [05_WIREFRAMES.md](./05_WIREFRAMES.md)
UI/UX デザインとワイヤーフレーム

**含まれる内容**
- 8つのページ/画面のテキストベースワイヤーフレーム
  1. ホーム画面
  2. 難易度選択画面
  3. 対局画面（全体レイアウト）
  4. 対局画面（盤面部分詳細）
  5. ゲーム終了画面
  6. キーボードショートカット表示（モーダル）
  7. レスポンシブ対応（タブレット、スマートフォン）
  8. ダークモード対応
- キーボード操作ガイド
- 色彩設計（WCAG AAA 準拠）
- コントラスト比の詳細

**対象読者**: UI/UX デザイナー、フロントエンド開発者

---

### 7. [06_ACCESSIBILITY_GUIDELINES.md](./06_ACCESSIBILITY_GUIDELINES.md)
詳細なアクセシビリティ実装ガイドライン

**含まれる内容**
- WCAG 2.1 AA/AAA 準拠の実装指針
- 4つの原則
  1. **知覚可能性** (Perceivable)
     - テキストの代替、色彩、テキスト間隔
  2. **操作可能性** (Operable)
     - キーボード操作、フォーカス管理
  3. **理解可能性** (Understandable)
     - 読みやすさ、予測可能性、入力支援
  4. **堅牢性** (Robust)
     - HTML 互換性、ARIA 使用法
- ARIA の詳細（ロール、プロパティ、属性）
- スクリーンリーダーテスト方法
- チェックリスト（開発用・テスト用）
- 参考リソースとテストツール
- 継続的改善計画

**対象読者**: 全開発者、QA テスター、アクセシビリティ専門家

---

## 🎯 ドキュメント使用ガイド

### プロジェクト開始時
1. **00_PROJECT_OVERVIEW.md** を読んで全体像を把握
2. **01_SYSTEM_ARCHITECTURE.md** で技術スタックを確認
3. **06_ACCESSIBILITY_GUIDELINES.md** で方針を理解

### UI/UX デザイン
1. **02_USER_FLOWS.md** でユーザー体験を理解
2. **05_WIREFRAMES.md** でワイヤーフレームを確認
3. **06_ACCESSIBILITY_GUIDELINES.md** で配色・フォントを確認

### バックエンド実装
1. **01_SYSTEM_ARCHITECTURE.md** でアーキテクチャを確認
2. **03_DATABASE_DESIGN.md** でDBスキーマを確認
3. **04_API_SPECIFICATION.md** で API仕様を確認

### フロントエンド実装
1. **02_USER_FLOWS.md** でユーザーフロー理解
2. **04_API_SPECIFICATION.md** で API仕様を確認
3. **05_WIREFRAMES.md** でUI要素を確認
4. **06_ACCESSIBILITY_GUIDELINES.md** でアクセシビリティ実装

### テスト
1. **02_USER_FLOWS.md** でテストシナリオを作成
2. **06_ACCESSIBILITY_GUIDELINES.md** でチェックリストを確認
3. 各ドキュメントの詳細仕様を確認
4. 自動テスト: PHP（Pest） + Puppeteer（アクセシビリティE2E + コントラスト + 全盲ユーザー対局 + 全機能E2E）

---

## 📋 主要な設計判断

### ユーザー認証
- **決定**: ユーザー登録不要、セッションベースの管理
- **理由**: 高齢者や視覚障害者にとって登録手続きは障害になる
- **実装**: Laravel のネイティブセッション機能を活用

### AI難易度（3段階）
- **決定**: 初級（ランダム）、中級（基本的な評価関数）、上級（先読み）
- **理由**: 初心者から上級者まで対応可能
- **実装**: 難易度ごとに異なるアルゴリズムを実装

### キーボード操作
- **決定**: 矢印キーで盤上移動、Enterで駒選択・移動（→で筋が小さい方向、←で筋が大きい方向）
- **理由**: 視覚障害者にとって直感的で学習しやすい
- **参考**: NVDA、JAWS でのテスト実施

### アクセシビリティ基準
- **決定**: WCAG 2.1 AAA を目指す（最低 AA）
- **理由**: 重度の視覚障害者・高齢者にも対応
- **実装**: 定期的な Lighthouse、WAVE テストで確認

---

## 🛠️ ドキュメント更新履歴

| 日付 | バージョン | 更新内容 | 作成者 |
|-----|---------|--------|--------|
| 2025-01-28 | 1.0 | 初版作成 | Design Team |
| 2026-02-02 | 1.1 | AI難易度/テスト/E2E反映 | Engineering |
| 2026-02-09 | 1.2 | 棋譜記録・CSRF対策・全盲テスト・不要ファイル整理 | Engineering |
| 2026-02-10 | 1.3 | undo 2手戻し・oard_states必須化・quit仕様・全機能E2Eテスト追加 | Engineering |
| 2026-02-11 | 1.4 | 矢印キー左右修正・AI指し手ハイライト（フォーカス移動なし）・駒台フォーカス操作・forced-colors対応 | Engineering |
| 2026-02-12 | 1.5 | WASD代替ナビゲーション・合法手ハイライト・AI★マーカー通常モード表示・ショートカットヒント画面内表示 | Engineering |
| 2026-02-12 | 1.6 | AI思考スピナー・トースト通知・盤面差分読み上げ・利き筋情報・合法手読み上げ・文字サイズ変更・ボタン分離・ツールチップ | Engineering |
| 2026-02-12 | 1.7 | 難易度補足・ふりがな・ガイダンス分割・片手操作(1/2キー)・駒台ボタンサイズ・トースト無効化・prefers-reduced-motion完全停止・選択状態バー・デバウンス・特大文字対応・持ち駒通知・フォント変更・ショートカット展開 | Engineering |
| 2026-02-13 | 1.8 | レイアウト改善: 駒台を盤面の左右に配置（後手=左上・先手=右下）・駒台サイズ拡大(min140px/max200px)・棋譜/表示設定/ショートカットをモーダルダイアログ化・info-panel高さ圧縮・board-area flexラッパー追加・モーダルのフォーカストラップ/Escape閉じ/フォーカス復帰対応 | Engineering |
| 2026-02-13 | 1.9 | 駒台再拡大(min180px/max240px,minH280px)・info-panel圧縮(操作ボタン/モーダルボタン3列grid横並び)・駒台内駒ボタン高さ修正(align-content:flex-startでstretch防止) | Engineering |
| 2026-02-13 | 2.0 | forced-colorsツールチップ修正(forced-color-adjust:none+Canvas/CanvasText)・ボタンデザイン改善(border-radius:6px・box-shadow・transformアニメーション・btn-secondaryスタイル)・HCモードツールチップ/ボタンスタイル対応 | Engineering |
| 2026-02-13 | 2.1 | ボタンデザイン全面改善: 木目調グラデーション(#F0E6D6→#E8DCC8)・焦げ茶文字(#3C2F1E)・btn-dangerクラス(投了用)・ツールチップ木目調統一・CSS変数でボタン配色一括管理 | Engineering |
| 2026-02-13 | 2.2 | お客様AIフィードバック反映: btn-secondary視認性改善(半透明ベージュ)・disabledボタン状態説明(dotted枠+grayscale+aria-describedby)・AI長考5秒再通知・モーダルボタン絵文字HTMLエンティティ化(aria-hidden) | Engineering |
| 2026-02-13 | 2.3 | お客様AIフィードバック反映: `<main>`重複解消(盤面セクションを`<section>`に変更)・ゲーム情報セクション`aria-live="polite"`追加・ランキングダイアログに閉じるボタン追加・ヘルプページキー名`<kbd>`マークアップ・`<kbd>`要素のCSSスタイル追加 | Engineering |
| 2026-02-13 | 2.4 | 多様な障害者アクセシビリティ改善: ホームページ全漢字にふりがな(ruby)追加(90箇所)・色覚多様性対応・感覚過敏配慮・about欄を全障害対応に更新 | Engineering |
| 2026-02-14 | 2.5 | 初心者テスト: 全盲初心者/弱視初心者ペルソナ検証・初回ガイダンス改善 | Engineering |
| 2026-02-14 | 3.0 | 最終品質検証: 棋士AIペルソナ(30テスト)・WebデザイナーAIペルソナ(37テスト)追加・タブレットレスポンシブ修正(768px)・ホームページCSS整理(inline style 36→1)・radio/checkboxフォーカスインジケータ強化・設計ドキュメント最終整理・README最終版 | Engineering |

---

## 📞 質問・フィードバック

ドキュメントについてのご質問やご指摘は、以下の方法でお知らせください：

- **Design ドキュメント**: このディレクトリの README を更新
- **API 仕様**: 04_API_SPECIFICATION.md を参照して質問
- **アクセシビリティ**: 06_ACCESSIBILITY_GUIDELINES.md を参照して質問

---

## ⚖️ ライセンス

このドキュメントセットは、a11y-shogi プロジェクトの一部です。
プロジェクトのライセンスに従ってください。

---

**最後に**: これらのドキュメントは「生きた設計書」です。
実装を進める中で、改善や追加が必要になれば、遠慮なく更新してください。
ただし、アーキテクチャ・API・DBスキーマの大きな変更は、
全チームと合意してから更新することをお勧めします。
