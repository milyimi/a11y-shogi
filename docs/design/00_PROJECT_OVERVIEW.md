# アクセシビリティ将棋アプリ - プロジェクト概要

## プロジェクト名
**a11y-shogi** - アクセシビリティに配慮した将棋アプリケーション

## ビジョン
全盲者・弱視者・上肢障害者・発達特性/学習障害・聴覚障害者・色覚多様性を含む**すべてのユーザー**が快適にAI相手の将棋を楽しめるアプリケーション

## コア機能

### 1. ゲーム機能
- **AI対局**: ユーザー vs AI による将棋対局
- **難易度選択**: 3段階の強さ設定
  - **初級（よわい）**: 高いランダム性（ミスを含む）
  - **中級（ふつう）**: 1手先読み + 簡易評価 + ミス率
  - **上級（つよい）**: 4手先ミニマックス + アルファベータ枝刈り + 詰み優先 + 大駒連携評価
- **セッション管理**: ユーザー登録不要、セッション別に対局管理
- **外部AI対局テスト**: python-shogi / USIエンジンとの対局検証（開発者向け）

### 2. アクセシビリティ機能
- **WCAG 2.1 AAA 準拠**: 最高レベルのアクセシビリティ基準を達成
- **スクリーンリーダー完全対応**: NVDA / JAWS / VoiceOver 対応のARIA属性完全実装
- **キーボード操作**: マウス不要で全操作可能（矢印キー + WASD代替、1/2キーで駒台操作）
- **高コントラスト**: コントラスト比 7:1 以上（AAA基準）、ダークモード、ハイコントラストモード
- **Windows強制カラーモード対応**: `forced-colors: active` メディアクエリでシステムカラー使用
- **色覚多様性対応**: 色だけに依存しない表示（形状・記号・テキスト・下線で区別）
- **ふりがな対応**: 全漢字にルビ（`<ruby>`）を付与し読字障害・知的障害にも対応
- **感覚過敏配慮**: `prefers-reduced-motion` 対応、アニメーション完全停止、トースト無効化可能
- **片手操作対応**: 1/2キーで駒台移動（Shift同時押し不要）、キー入力デバウンス
- **UDフォント**: UDデジタル教科書体・BIZ UDゴシック選択可能
- **トースト通知**: 移動・エラーを視覚トーストで通知（無効化可能）
- **合法手ハイライト**: 駒選択時に移動可能マスを緑色ドット＋aria-liveで読み上げ
- **AIハイライト**: AI最終手を★マーカーで視覚表示
- **盤面差分読み上げ**: Shift+Bで前回からの変化のみ読み上げ
- **モーダルダイアログ**: 棋譜・設定・ショートカットをモーダル化（フォーカストラップ・Escape閉じ）
- **セッション期限切れ対応**: CSRFトークン期限切れ時にアクセシブルなダイアログで通知
- **初期ガイダンス**: ゲーム開始時に操作方法をaria-liveで自動アナウンス

### 3. ユーザー体験
- 自動保存とリジューム機能
- 将棋盤の木目調デザイン（温かみのある配色）
- ボタン分離設計（投了ボタンは赤色で分離配置し誤操作防止）
- レスポンシブデザイン（1199px / 799px / 480px の3段階ブレークポイント）

### 4. ランキング機能
- **勝利時のニックネーム登録**: AI に勝利したユーザーはニックネームを登録可能
- **難易度別ランキング**: 初級・中級・上級それぞれのランキング
- **匿名性の維持**: ユーザー登録不要、ニックネームのみで参加
- **ランキング表示**: 勝利回数、手数、対局時間などで順位付け

## 技術スタック

- **バックエンド**: Laravel 12.48.1, PHP 8.3.27
- **フロントエンド**: Blade テンプレート + Tailwind CSS + Vanilla JavaScript
- **データベース**: SQLite
- **AI エンジン**: 
  - PHP Minimax (depth=4, 500K transposition table, Alpha-Beta Pruning)
  - 外部エンジン: python-shogi 1.1.1, Fairy-Stockfish 11.1 (USI)
- **テスト**: 下記「テスト体制」参照
- **言語**: PHP 8.3.27, Python 3.11, JavaScript (Node.js + Puppeteer)

## アクセシビリティ基準
- **WCAG 2.1 AAA 準拠**（達成済み）
- WAI-ARIA ガイドライン準拠
- Windows 強制カラーモード（forced-colors）対応
- 日本の障害者差別解消法対応

## ユーザー層
- 視覚障害者（全盲者・弱視者）
- 上肢障害者（片手操作・脳性麻痺）
- 発達特性/学習障害（ディスレクシア・知的障害）
- 色覚多様性（P型・D型・T型色覚）
- 加齢による見えにくさのある人（弱視＋手の震え）
- 聴覚障害者（ろう者・難聴者）
- 感覚過敏（ADHD・自閉スペクトラム症・てんかん）
- キーボード操作を好むユーザー
- 将棋初心者から中級者

## テスト体制

現在のテストスイート：

| テストカテゴリ | 実行スクリプト | テスト数 | 内容 |
|---|---|---|---|
| PHP (Pest)  | `npm run test:php` | 125 | ルール検証、AI評価、成り・持ち駒、ボード境界等 |
| **アクセシビリティテスト（8種）** | `npm run test:a11y` | 227 | 全盲～色覚異常まで網羅。以下の8種類：|
| ・全盲ユーザー対局 | - | 87 | 実際の対局シミュレーション（22フェーズ） |
| ・全盲ユーザー拡張テスト | - | 21 | Shift+キー複合、マルチゲーム、エラー回復 |
| ・弱視ユーザー対局シミュレーション | - | 35 | ズーム対応（200%-400%）、テキスト、コントラスト、モバイル |
| ・WCAG AAA色対比検証 | - | 28 | ダーク/ハイコントラストモード |
| ・周辺視野喪失ユーザーテスト | - | 20 | 視野制限シミュレーション |
| ・パーキンソン病ユーザーテスト | - | 7 | 振戦対応、デバウンス |
| ・低スペック環境テスト | - | 12 | 3G遅延、キャッシュ、オフライン |
| ・色覚異常ユーザーテスト | - | 17 | 1型/2型/3型色覚シミュレーション |
| **AIペルソナテスト（10種）** | `npm run test:ai` | 364 | 障害者～専門家ペルソナ。詳細は以下：|
| ・障害者AIペルソナ Wave 1 | - | 45 | 上肢障害・色覚・発達特性・聴覚・加齢・ADHD |
| ・障害者AIペルソナ Wave 2 | - | 33 | 脳性麻痺・ディスレクシア・400%ズーム・自閉症 |
| ・障害者AIペルソナ Wave 3 | - | 26 | 知的障害・片麻痺・てんかん・WCAG AAA |
| ・加齢による見えにくさAI | - | 62 | 視認性・マウス操作・誤操作復帰・安定性 |
| ・子供・初心者AI | - | 28 | ふりがな・直感性・エラー親切さ |
| ・UXリサーチャーAI | - | 45 | ニールセン10原則・情報負荷・一貫性 |
| ・教育者AI | - | 30 | 授業活用・安全性・多様な障がい |
| ・モバイルユーザーAI | - | 28 | スマホ視認性・タッチ・レスポンシブ |
| ・棋士AIペルソナ | - | 30 | 初期配置・駒移動・将棋用語・ゲームフロー |
| ・WebデザイナーAI | - | 37 | レイアウト・レスポンシブ・配色・一貫性 |
| **E2E 統合テスト** | `npm run test:e2e` | 59 | ブラウザ経由の全機能動作検証（15カテゴリ） |
| **全テスト実行** | `npm run test:all` | **775** | 全テストを順序実行 |

### テスト実行方法

```bash
# 個別実行
npm run test:php      # PHPテスト（125テスト）
npm run test:a11y     # アクセシビリティテスト（227テスト）
npm run test:ai       # AIペルソナテスト（364テスト）
npm run test:e2e      # E2E統合テスト（59テスト）

# 全テスト実行
npm run test:all      # 全テスト（775テスト）
```

## 成功指標
- スクリーンリーダー利用者による100%操作可能性 ✅
- キーボードのみでの全機能操作可能性 ✅
- 初級AIとの対局完了率 > 90% ✅
- WCAG 2.1 AAA コントラスト比 7:1 以上 ✅
- 18種類の障害者ペルソナによる品質検証 0 failures ✅
- 棋士・Webデザイナー専門家ペルソナによる品質検証 0 failures ✅
- 加齢による見えにくさのある人・子供・UX・教育者・モバイル 5ペルソナによる品質検証 0 failures ✅
